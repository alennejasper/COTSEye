<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        @media print {
            .print-button {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div>
        <div class="container  mt-3">
            <button class="btn btn-primary print-button" onclick="printPage()">Print</button>
        </div>
    </div>

    <div class = "status" id = "status-filter">
        <form action = "" class = "status-form" method = "GET">
            {% csrf_token %}

            <div class = "card-header">
                <header>Filter statuses</header>
            </div>

            <div class = "card-body">
                <div class = "field">
                    <div class = "column">
                        <label for = "from-date">From</label> 
                            
                        <div class = "from-date">
                            <input type = "date" value = "" id = "from-date" name = "from_date" required>                            
                        </div>

                        <label for = "to-date">To</label> 

                        <div class = "to-date">
                            <input type = "date" value = "" id = "to-date" name = "to_date" required>                            
                        </div>
                    </div>

                    <div class = "column">
                        <label for = "location">Location</label> 

                        <select name = "location" id = "location">
                            <option disabled selected value>Choose location</option>

                            <option value = "each_location">Each location</option>

                            {% for option in options %}
                                <option value = "{{option.location.id}}">{{option.location}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class = "button">
                    <a class = "filter-statuses" type = "submit">Filter</a>
                </div>    
            </div>
        </form>
    </div>

    {% if messages %}
        {% for message in messages %}
            {% if message.tags == "info" %}<script>Swal.fire({title: "Hey!", text: "{{message}}", background: "#FFFFFF", icon: "warning", iconColor: "#154360", allowOutsideClick: false, allowEscapeKey: false, confirmButtonColor: "#154360", customClass: {confirmButton: "info-button", title: "title"}})</script>
            
            {% elif message.tags == "success" %}<script>Swal.fire({title: "Yay!", text: "{{message}}", background: "#FFFFFF", icon: "success", iconColor: "#698F3F", allowOutsideClick: false, allowEscapeKey: false, confirmButtonColor: "#698F3F", customClass: {confirmButton: "success-button", title: "title"}})</script>
            
            {% else %}<script>Swal.fire({title: "Oops!", text: "{{message}}", background: "#FFFFFF", icon: "error", iconColor: "#C90016", allowOutsideClick: false, allowEscapeKey: false, confirmButtonColor: "#C90016", customClass: {confirmButton: "error-button", title: "title"}})</script>
            
            {% endif %}    
        {% endfor %}
    {% endif %}

    <script>
        document.querySelector(".filter-statuses").onclick = function() {
            document.querySelector(".status-form").submit();
        }
    </script>

    <div>
        <h2 class="text-center mt-5 text-primary-emphasis">
            insert Logos and Repoprt Title Here (Header)
        </h2>
    </div>
    <div>
        <h2 class="text-center mt-5 text-primary-emphasis">
            Insert TITLE here
        </h2>
    </div>
    <div class="container mt-5">
        <table class="table table-bordered border-black">
            <thead>
                <tr>
                  <th class="text-center">Municipality</th>
                  <th class="text-center">Barangay</th>
                  <th class="text-center">Total No. of Valid Report Sightings</th>
                  <th class="text-center">Total No. of Cots Captured</th>
                </tr>
              </thead>
              <tbody>
                    {% for result in results %}
                        <tr>
                            <td class="text-center">{{result.location.barangay}}</td>
                        
                            <td class="text-center">{{result.location.municipality}}</td>
                                                    
                            <td class="text-center">{{valid_posts}}</td>

                            <td class="text-center">{{result.caught_overall}}</td>
                        </tr>
                    {% endfor %}
              </tbody>
        </table>
    </div>
    <div class="text-center mt-5 mb-5">
        <h2 class="text-center text-info">
            Total No. of Caught COTS as of {{from_date | date:'m/d/y'}} to {{to_date | date:'m/d/y'}}
        </h2>
    </div>
    <div class = "map-graph"></div>

        <script>
            var categories = [];

            var data = [];

            {% for result in results %}
                categories.push("{{result.location.barangay}}, {{result.location.municipality}}");

                data.push({
                    x: "{{result.location.barangay}}, {{result.location.municipality}}",

                    y: {{result.caught_overall}}, fillColor: {{result.caught_overall}} < 25 ? "#698F3F" : {{result.caught_overall}} < 75 ? "#F4C430" : "#C90016"
                });
            {% endfor %}
        
            var configurations = {
                series: [{
                    name: "Caught Overall",

                    data: data
                }],

                chart: {
                    fontFamily: "Open Sans",

                    height: 500,
                    
                    type: "bar",

                    toolbar: {
                        show: false
                    },

                    zoom: {
                        enabled: false
                    },
                },

                legend: {
                    show: false  
                },

                plotOptions: {
                    bar: {
                        distributed: true,

                        colors: {
                            ranges: [{
                                from: 0,

                                to: 24,

                                color: "#698F3F"

                            }, {
                                from: 25,

                                to: 74,

                                color: "#F4C430"

                            }, {
                                from: 75,

                                to: undefined,

                                color: "#C90016"
                            }]
                        }
                    }
                },

                tooltip: {
                    style: {
                        fontSize: '14px',
                    }
                },

                xaxis: {
                    categories: categories,

                    title: {
                        text: "Coastal Barangays",

                        style: {
                            fontSize: "14px",

                            fontWeight: "700",
                        }
                    },

                    labels: {
                        style: {
                            fontSize: "14px", 

                            fontWeight: "400"
                        }
                    }
                },

                yaxis: {
                    title: {
                        text: "COTS Caught",

                        style: {
                            fontSize: "14px",

                            fontWeight: "700",
                        }
                    },

                    labels: {
                        style: {
                            fontSize: "14px", 

                            fontWeight: "400"
                        }
                    }
                },
            };
        
            var graph = new ApexCharts(document.querySelector(".map-graph"), configurations);
            
            graph.render();
        </script>
</script>
</body>
</html>