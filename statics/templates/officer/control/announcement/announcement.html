{% extends "officer/control/index/index.html" %}

{% block content %}
<div class="container-fluid mt-3">
    
    
    <div class="d-flex justify-content-end">
        <button style="background-color: rgb(30, 173, 95);" onclick="window.location.href='{% url 'Officer Control Add Announcement' %}'" class="btn btn-primary mt-4">ADD NEW</button>
    </div>

    <div class="card mt-4">
        <div style="text-align: center; font-weight: 500; font-size: larger;" class="card-header bg-primary text-white">MANAGE ANNOUNCEMENTS</div>
        <div class="card-body">
            <table class="table table-bordered table-striped">
                <thead class="thead-dark">
                    <tr>
                        <th>Title</th>
                        <th>Date</th>
                        <th>Location</th>
                        <th>Description</th>
                        <th>Posted By</th>
                        <th>Photo</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="announcementsTable">
                    <!-- Announcements will be added here dynamically -->
                </tbody>
            </table>
            <nav aria-label="Page navigation example">
                <ul class="pagination justify-content-center" id="pagination">
                    <li class="page-item" id="previousPage">
                        <a class="page-link" href="#" onclick="changePage('prev')">Previous</a>
                    </li>
                    <!-- Page numbers will be inserted here by JavaScript -->
                    <li class="page-item" id="nextPage">
                        <a class="page-link" href="#" onclick="changePage('next')">Next</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const announcements = [
            { title: "Event 1", date: "2024-01-01", location: "Location 1", description: "Description 1", user: "User 1", photo: null },
            { title: "Event 2", date: "2024-01-02", location: "Location 2", description: "Description 2", user: "User 2", photo: null },
            { title: "Event 3", date: "2024-01-03", location: "Location 3", description: "Description 3", user: "User 3", photo: null },
            { title: "Event 4", date: "2024-01-04", location: "Location 4", description: "Description 4", user: "User 4", photo: null },
            { title: "Event 5", date: "2024-01-05", location: "Location 5", description: "Description 5", user: "User 5", photo: null },
            { title: "Event 6", date: "2024-01-06", location: "Location 6", description: "Description 6", user: "User 6", photo: null },
            { title: "Event 7", date: "2024-01-07", location: "Location 7", description: "Description 7", user: "User 7", photo: null },
            { title: "Event 8", date: "2024-01-08", location: "Location 8", description: "Description 8", user: "User 8", photo: null },
            { title: "Event 9", date: "2024-01-09", location: "Location 9", description: "Description 9", user: "User 9", photo: null },
            { title: "Event 10", date: "2024-01-10", location: "Location 10", description: "Description 10", user: "User 10", photo: null },
            { title: "Event 11", date: "2024-01-11", location: "Location 11", description: "Description 11", user: "User 11", photo: null },
            { title: "Event 12", date: "2024-01-12", location: "Location 12", description: "Description 12", user: "User 12", photo: null },
            { title: "Event 13", date: "2024-01-13", location: "Location 13", description: "Description 13", user: "User 13", photo: null },
            { title: "Event 14", date: "2024-01-14", location: "Location 14", description: "Description 14", user: "User 14", photo: null },
            { title: "Event 15", date: "2024-01-15", location: "Location 15", description: "Description 15", user: "User 15", photo: null },
            { title: "Event 16", date: "2024-01-16", location: "Location 16", description: "Description 16", user: "User 16", photo: null },
            { title: "Event 17", date: "2024-01-17", location: "Location 17", description: "Description 17", user: "User 17", photo: null },
            { title: "Event 18", date: "2024-01-18", location: "Location 18", description: "Description 18", user: "User 18", photo: null },
            { title: "Event 19", date: "2024-01-19", location: "Location 19", description: "Description 19", user: "User 19", photo: null },
            { title: "Event 20", date: "2024-01-20", location: "Location 20", description: "Description 20", user: "User 20", photo: null }
        ];

        let currentPage = 1;
        const itemsPerPage = 10;

        function displayAnnouncements(page) {
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedAnnouncements = announcements.slice(startIndex, endIndex);

            let table = document.getElementById('announcementsTable');
            table.innerHTML = '';

            paginatedAnnouncements.forEach((announcement, index) => {
                let row = table.insertRow();
                row.insertCell(0).innerText = announcement.title;
                row.insertCell(1).innerText = announcement.date;
                row.insertCell(2).innerText = announcement.location;
                row.insertCell(3).innerText = announcement.description;
                row.insertCell(4).innerText = announcement.user;

                let photoCell = row.insertCell(5);
                if (announcement.photo) {
                    let img = document.createElement('img');
                    img.src = URL.createObjectURL(announcement.photo);
                    img.style.width = '50px';
                    img.style.height = '50px';
                    photoCell.appendChild(img);
                } else {
                    photoCell.innerText = 'No Photo';
                }

                let actionsCell = row.insertCell(6);
                let updateButton = document.createElement('button');
                updateButton.innerText = 'Update';
                updateButton.classList.add('btn', 'btn-primary', 'btn-sm', 'mr-2');
                updateButton.addEventListener('click', function() {
                    window.location.href = "{% url 'Officer Control Update Announcement' %}";
                });
                actionsCell.appendChild(updateButton);

                let deleteButton = document.createElement('button');
                deleteButton.innerText = 'Delete';
                deleteButton.classList.add('btn', 'btn-danger', 'btn-sm', 'ml-2');
                deleteButton.addEventListener('click', function() {
                    announcements.splice(startIndex + index, 1);
                    localStorage.setItem('announcements', JSON.stringify(announcements));
                    displayAnnouncements(currentPage);
                });
                actionsCell.appendChild(deleteButton);
            });

            const pagination = document.getElementById('pagination');
            const totalPages = Math.ceil(announcements.length / itemsPerPage);
            pagination.innerHTML = `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage('prev')">Previous</a>
                </li>
            `;

            for (let i = 1; i <= totalPages; i++) {
                pagination.innerHTML += `
                    <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                    </li>
                `;
            }

            pagination.innerHTML += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage('next')">Next</a>
                </li>
            `;
        }

        window.changePage = function(action) {
            const totalPages = Math.ceil(announcements.length / itemsPerPage);

            if (action === 'prev' && currentPage > 1) {
                currentPage--;
            } else if (action === 'next' && currentPage < totalPages) {
                currentPage++;
            } else if (typeof action === 'number') {
                currentPage = action;
            }

            displayAnnouncements(currentPage);
        };

        displayAnnouncements(currentPage);
    });
</script>
{% endblock %}
