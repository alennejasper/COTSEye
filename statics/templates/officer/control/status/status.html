{% extends "officer/control/index/index.html" %}
{% load static %}
{% load custom_filters %}

{% block content %}
    <link href = "https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <script src = "https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script src = "https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link rel = "stylesheet" href = "https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    
    <script src = "https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <link rel = "stylesheet" href = "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <link rel = "stylesheet" href = "{% static 'css/officer/control/status/status.css' %}" >

    {% block status-content %}
        <div class = "report-button" style = "float: right; margin-top: 7px; margin-bottom: 0px;">
            <button onclick = "window.location.href = '{% url 'Officer Control Report' %}'">GENERATE REPORT</button>
        </div>

        <h2 style = "border-bottom: 1px solid rgba(229, 229, 229); font-family: 'Montserrat'; font-weight: 700; font-size: 20px; color: rgb(52, 144, 242); text-align: left; text-transform: uppercase;">Infestation Status</h3>
    
        <div class = "container-fluid mt-3" style = "display: table; margin-bottom: 15px !important; padding-left: 0px !important; padding-right: 0px !important; width: 100%;">
            <table class = "table table-hover">
                <thead>
                    <tr>
                        <th style = "display: table-cell; max-width: 0px; font-family: 'Montserrat'; font-weight: 700; font-size: 16px; color: rgb(28, 169, 234);" scope = "col">Activity Date</th>
                        
                        <th style = "display: table-cell; max-width: 0px; font-family: 'Montserrat'; font-weight: 700; font-size: 16px; color: rgb(28, 169, 234);" scope = "col">Municipality</th>
                        
                        <th style = "display: table-cell; max-width: 0px; font-family: 'Montserrat'; font-weight: 700; font-size: 16px; color: rgb(28, 169, 234);" scope = "col">Total No. of COTS Collected</th>
                        
                        <th style = "display: table-cell; max-width: 0px; font-family: 'Montserrat'; font-weight: 700; font-size: 16px; color: rgb(28, 169, 234);" scope = "col">Infestation Level</th>
                        
                    </tr>
                </thead>
                
                <tbody class = "table-group-divider" style = "cursor: pointer;">
                    {% for status in paginated_statuses %}
                        <tr data-href = "{% url 'Officer Control Status Municipality Read' status.location.municipality %}">
                            <td style = "display: table-cell !important; max-width: 0px; font-family: 'Montserrat'; font-weight: 400; font-size: 12px;">{{status.onset_date | format_date_mmddyy}}</td>

                            <td style = "display: table-cell !important; max-width: 0px; font-family: 'Montserrat'; font-weight: 400; font-size: 12px;">{{status.location.municipality}}</td>
                            
                            <td style = "display: table-cell !important; max-width: 0px; font-family: 'Montserrat'; font-weight: 400; font-size: 12px;">{{status.caught_overall}}</td>

                            <td style = "display: table-cell !important; max-width: 0px; font-family: 'Montserrat'; font-weight: 700; font-size: 12px;" class = "status-{{status.statustype}}">{{status.statustype}}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

            <nav>
                <ul class = "pagination justify-content-center">
                    {% if paginated_statuses.has_previous %}
                        <li class = "page-item">
                            <a class = "page-link" href = "?page = {{paginated_statuses.previous_page_number}}" aria-label = "Previous">
                                <span aria-hidden = "true">&laquo;</span>
                            </a>
                        </li>
                    {% endif %}

                    {% for num in paginated_statuses.paginator.page_range %}
                        {% if paginated_statuses.number == num %}
                            <li class = "page-item active">
                                <a class = "page-link" href = "?page = {{num}}">{{num}}</a>
                            </li>
                        
                        {% else %}
                            <li class = "page-item">
                                <a class = "page-link" href = "?page = {{num}}">{{num}}</a>
                            </li>
                        {% endif %}
                    {% endfor %}

                    {% if paginated_statuses.has_next %}
                        <li class = "page-item">
                            <a class = "page-link" href = "?page = {{paginated_statuses.next_page_number}}" aria-label = "Next">
                                <span aria-hidden = "true">&raquo;</span>
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        </div> 
    
        <script>
            document.addEventListener("DOMContentLoaded", function(){
                var rows = document.querySelectorAll("tr[data-href]");

                rows.forEach(row => {
                    row.addEventListener("click", function(){
                        window.location.href = this.dataset.href;
                    });
                });
            });
        </script>
    {% endblock %}
{% endblock %}
